# ルーレットアプリ 実装計画（Codex案）

## 概要
- 対象: `docs/requirements.md` で定義したスマホ特化ルーレットアプリ。
- ゴール: GitHub Pages で稼働する MVP を段階的に完成させる。
- 方針: 機能フェーズを 4 つに分割し、各フェーズでレビュー可能な成果物を用意する。

## フェーズ構成
### フェーズ1: プロジェクト初期化
- **成果物**: ベースとなるリポジトリ構成、開発ドキュメント。
- **主な作業**
  - ビルド無しの純粋な HTML/CSS/JavaScript で開始し、必要なら後からツール導入。
  - `index.html` にビューポート設定と基本レイアウトを作成（ヘッダ＋ルーレット領域＋結果表示）。
  - スタイルの土台としてベース CSS（モバイル幅フィット、中央配置、フォント設定等）を定義。
  - GitHub Pages 用に公開手順メモを `README` に追記。（後フェーズで更新予定）
- **検証ポイント**: スマホ幅での基本 UI 枠組みが崩れないか、GitHub Pages で配信できる構成か。

### フェーズ2: ルーレット描画と枠数管理
- **成果物**: 枠数変更に追従するルーレット描画機能。
- **主な作業**
  - 枠数プルダウン（2～20）を実装し、イベントでルーレット描画関数を呼ぶ。
  - Canvas もしくは SVG を用いて円形セクションを等分割表示。初期値は 6 枠程度を想定。
  - 番号テキストを表示（中央寄せ）、スマホ表示でも視認できるフォントサイズに調整。
  - 各枠を別色にするカラーパレット生成ロジックを作成（HSL ベースの自動生成など）。
  - 回転状態のフラグと UI 無効化の下準備（回転中はプルダウンを disable）を実装。
- **検証ポイント**: 各枠数での描画崩れがないか、色割り当てに偏りがないか。

### フェーズ3: スワイプ回転ロジック
- **成果物**: 実際に指で回転でき、結果が表示されるルーレット。
- **主な作業**
  - タッチイベントから初速（スワイプ方向と速度）を算出し、`requestAnimationFrame` ベースの慣性アニメーションを構築。
  - 角速度・減速率を調整して自然な停止挙動を実現。停止条件（角速度が閾値以下）を定義。
  - 回転中は UI 要素全体を無効化し、状態マシン（`idle` / `spinning` / `finished`）で制御。
  - 停止角度から該当枠番号を算出し、枠をハイライト。結果テキストを更新して保持。
  - 回転が完全停止した後に UI を再有効化。
- **検証ポイント**: スワイプ強弱で回転距離が変わるか、結果が正確か、回転中に操作が受け付けられないか。

### フェーズ4: 公開準備と品質確認
- **成果物**: 公開可能なビルド、テスト手順、公開手順書。
- **主な作業**
  - `README` に利用方法（操作手順・対応環境）と開発手順（起動、lint 等）をまとめる。
  - 手動テストケースを `docs/tests-manual.md` などで整理（枠数変更、スワイプ強弱、結果整合性）。
  - GitHub Pages での公開設定（`docs/` ディレクトリ公開または `gh-pages` ブランチ）を整備し、デプロイ手順を確認。
  - Lighthouse またはブラウザ DevTools でパフォーマンス・アクセシビリティを簡易チェック。
- **検証ポイント**: GitHub Pages 上で問題なく動作するか、主要ブラウザで崩れがないか。

## 未決項目と意思決定タイミング
- **枠番号の並び順**: 初期実装では時計回りを仮仕様とし、フィードバック次第で調整。フェーズ2で確定。
- **乱数／物理シミュレーション**: 疑似乱数ベースの慣性値調整で開始し、満足度に応じて改善。フェーズ3実装時に検証。
- **カラーパレット**: アクセシビリティを考慮しつつ HSL 計算で実装。必要ならフェーズ3以降で手動カラーテーブル導入。

## リスクと対策
- **モバイル性能差**: 低スペック端末でのアニメーション遅延が懸念 → フェーズ3で軽量化（Canvas 最適化、描画頻度調整）を検討。
- **操作感の不一致**: スワイプ速度と停止時間が期待とずれる可能性 → フェーズ3で実機テスト／ユーザーフィードバックを組む。
- **GitHub Pages 公開遅延**: 高速公開のため、早期に Pages 設定を検証し、デプロイスクリプトをフェーズ4で整える。

## 参考タスク一覧（例）
1. 初期 HTML/CSS/JS の雛形作成
2. プルダウン UI と状態管理実装
3. ルーレットセクション描画（Canvas/SVG）
4. カラーパレット生成＋枠番号表示
5. スワイプジェスチャー検出と慣性アニメーション
6. 停止判定と結果ハイライト・表示
7. 回転中の操作ロック制御
8. テストシナリオ整理と GitHub Pages 公開手順書作成

上記を基に、各フェーズ完了時にレビューを行い、仕様差異があれば `docs/requirements.md` を更新しながら進行する計画とする。
